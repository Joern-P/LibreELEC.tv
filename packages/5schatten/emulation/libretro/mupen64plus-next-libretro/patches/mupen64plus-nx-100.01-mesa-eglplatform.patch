From 32a34a65055d944a8dc6d439650d7f343280da7b Mon Sep 17 00:00:00 2001
From: 5schatten <supervisedthinking@gmail.com>
Date: Sun, 15 Sep 2019 23:03:44 +0200
Subject: [PATCH] Makefile: added COREFLAGS to define MESA_EGL_NO_X11_HEADERS
 for eglplatform.h if mesa is used for AMLGX

---
 Makefile | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/Makefile b/Makefile
index ba49e623..eb5b1754 100644
--- a/Makefile
+++ b/Makefile
@@ -249,6 +249,10 @@ else ifneq (,$(findstring AMLG,$(platform)))
       endif
    endif
 
+   ifneq (,$(findstring mesa,$(platform)))
+     COREFLAGS += -DMESA_EGL_NO_X11_HEADERS
+   endif
+
    GL_LIB := -lGLESv2
    HAVE_NEON = 1
    WITH_DYNAREC=arm
@@ -283,7 +283,9 @@
       CPUFLAGS += -march=armv8-a+crc -mfloat-abi=hard -mfpu=neon-fp-armv8
       ifneq (,$(findstring RK3399,$(platform)))
          CPUFLAGS += -mtune=cortex-a72.cortex-a53
-         GLES3 = 1
+         GLES3 = 1
+	  HAVE_PARALLEL_RSP = 1
+         HAVE_THR_AL = 1
       else ifneq (,$(findstring RK3328,$(platform)))
          CPUFLAGS += -mtune=cortex-a53
          GLES = 1
diff --git a/GLideN64/src/Graphics/OpenGLContext/opengl_Utils.cpp b/GLideN64/src/Graphics/OpenGLContext/opengl_Utils.cpp
index 0279af9..dbc09fe 100644
--- a/GLideN64/src/Graphics/OpenGLContext/opengl_Utils.cpp
+++ b/GLideN64/src/Graphics/OpenGLContext/opengl_Utils.cpp
@@ -61,7 +61,7 @@ bool Utils::isEGLExtensionSupported(const char * extension)
		return false;
	}

	const char* start = extensions;
-	for (;;) {
+	while (start) {
 		where = strstr(start, extension);
 		if (where == nullptr)
 			break;          
